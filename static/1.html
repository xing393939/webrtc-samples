
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>WebRTC TEST</title>
	<style>
		video {
			object-fit: cover;
		}
	</style>
</head>
<body>
	<div id="log"></div>
	<script src="peer.min.js"></script>
	<script>
	(function() {
		var log = function(msg) {
			document.getElementById('log').innerHTML += msg + '<br />';
		};

		var serverId = location.search.replace('?', '');
		if(!serverId) {
			serverId = (+new Date).toString(36) + '_' + (Math.random().toString()).split('.')[1];
		}

		history.replaceState('', '', '?' + serverId);

		var peer = new Peer(serverId, {
			host: 'localhost',
			port: 9003,
			path: '/',
			config: {
				'iceServers': [
	      			{ url: 'stun:stun.l.google.com:19302' }
	    		]
	    	}
		});

		navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

		var constraints = {
			audio: false,
			video: true
		};

		navigator.getUserMedia(constraints, function(stream) {
			window.stream = stream;
			log('获取摄像头成功！');
			log('等待连接...');
			log('<a target="_blank" href="index.html?' + serverId + '">点击进入直播页面</a>');
		}, function(err) {
			log('获取摄像头失败！');
		});

		peer.on('connection', function(conn) {
			conn.on('data', function(clientId){
				log('新连接：' + clientId);
				var call = peer.call(clientId, window.stream);

				call.on('close', function() {
					log('已关闭：' + clientId);
				});
			});
		});
	})();
	</script>
<div style="margin-top:50px;"><a href="https://www.imququ.com/post/html5-live-player-3.html">返回「HTML5 视频直播（三）」</a></div>

</body>
</html>
